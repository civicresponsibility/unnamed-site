{% extends "master.html" %}
{% load itfsite_utils %}

{% block title %}{{trigger.title}}{% endblock %}

{% block head %}
<style>

</style>
{% endblock %}

{% block body %}

<div class="row">
	<div class="col-md-4">
		<h1>{{trigger.title}}</h1>

		{{trigger.description|render_text:trigger.description_format}}

		{% if trigger.extra.type == "usbill" %}
			<p class="text-muted small">More info on this {{trigger.extra.bill_info.noun}} can be found on <a href="{{trigger.extra.bill_info.link}}">GovTrack</a>.</p>
		{% endif %}

		{% if trigger.status|stringformat:'s' == 'TriggerStatus.Open' or trigger.status|stringformat:'s' == 'TriggerStatus.Paused' or trigger.status|stringformat:'s' == 'TriggerStatus.Vacated' %}
				<h2>Pledged Contributions</h2>

				<div>${{trigger.total_pledged}}</div>
				<p>has been pledged on both sides of this issue.</p>

				<p>We can&rsquo;t reveal any more information prior to the vote.</p>

				{% if trigger.status|stringformat:'s' == 'TriggerStatus.Vacated' %}
					<p class="text-danger">Pledges were vacated.</p>
				{% endif %}
		{% endif %}
	</div>

	<div class="col-sm-8">
		{% if trigger.status|stringformat:'s' == 'TriggerStatus.Draft' %}
			<p>This trigger is in draft status. That means it is currently being prepared. Contributions may be accepted soon.</p>

		{% elif trigger.status|stringformat:'s' == 'TriggerStatus.Open' %}
			{% include "contrib/pledge-form.html" %}

		{% elif trigger.status|stringformat:'s' == 'TriggerStatus.Paused' %}
			<h2>Take action</h2>
			<p>This action is paused. We may be about to convert the pledges into campaign contributions or we may be researching whether the event occurred.</p>

		{% elif trigger.status|stringformat:'s' == 'TriggerStatus.Vacated' %}
			<h2>Closed</h2>
			<p>This action has been cancelled. We determined that the event will likely never occur and have vacated all of the pledges.</p>

		{% elif trigger.status|stringformat:'s' == 'TriggerStatus.Executed' %}
			<div id="my-pledge">
			</div>
			
			<h2>Contributions</h2>
			
			{{execution.description|render_text:execution.description_format}}

			<h3>Totals</h3>

			<div class="row">
				<div class="col-sm-6 col-md-4">
					<table class="table" style="width: auto">
					{% for outcome in outcomes %}
						<tr>
							<th>{{outcome.label}}</th>
							<td>${{outcome.contribs|floatformat:2}}</td>
						</tr>
					{% endfor %}
					<tr style="color: #333; background-color: #F5F5F5">
						<th>Total</th>
						<td style="font-weight: bold">${{execution.total_contributions|floatformat:2}}</td>
					</tr>
					</table>
				</div>
				<div class="col-sm-6 col-md-4">
					<table class="table" style="width: auto">
					{% for row in by_incumb_chlngr %}
						<tr class="{{row.2}}">
							<th>{{row.0}}</th>
							<td>${{row.1|floatformat:2}}</td>
						</tr>
					{% endfor %}
					<tr style="color: #333; background-color: #F5F5F5">
						<th>Total</th>
						<td style="font-weight: bold">${{execution.total_contributions|floatformat:2}}</td>
					</tr>
					</table>
				</div>
			</div>

			<h3>Contributions to {{trigger.strings.actors|capfirst}}</h3>

			<table class="table" style="width: auto">
			<thead>
				<tr>
					<th>Candidate</th>
					<th>Contributions<br>To Candidate</th>
					<th>Contributions<br>To Opponent</th>
				</tr>
			</thead>
			<tbody>
			{% for action in actions %}
				<tr>
					<td>{{action.actor.name_long}}</td>
					<td class="{% if action.total_contributions_for %}text-success{% else %}text-muted{% endif %}">${{action.total_contributions_for|floatformat:2}}</td>
					<td class="{% if action.total_contributions_against %}text-danger{% else %}text-muted{% endif %}">${{action.total_contributions_against|floatformat:2}}</td>
				</tr>
			{% endfor %}
			</tbody>
			</table>

		{% endif %}
				
	</div>
</div>

{% endblock %}

{% block scripts %}
<script src="/static/js/ext/jquery.payment.js"> </script>
<script>
	$(function() {
		{% if trigger.status|stringformat:'s' == 'TriggerStatus.Open' %}
			pledge_init();
		{% endif %}
		{% if trigger.status|stringformat:'s' == 'TriggerStatus.Executed' %}
		  if (the_page && the_page.pledge_made) {
		    $('#my-pledge').html(the_page.pledge_made);
		  }
		{% endif %}
	})
</script>
{% endblock %}
{% load itfsite_utils %}

<h2>Your Contribution</h2>

{% if not pledge.user %}
<div class="alert alert-warning">
	We sent an email to {{pledge.email}}. You must click the link in the email to confirm your email address before this contribution can be scheduled.
</div>
{% endif %}

<p>You {% if pledge.status|stringformat:'s' == 'PledgeStatus.Executed' %}made{% elif pledge.status|stringformat:'s' == 'PledgeStatus.Open' %}have scheduled{% else %}scheduled{% endif %} a campaign contribution for this {{trigger.strings.action}}:</p>

<dl>
		<dt>Amount</dt>
		<dd>
			{% if not execution %}
				${{pledge.amount|floatformat:2}}
			{% else %}
				${{execution.charged|floatformat:2}}
				{% if execution.charged < pledge.amount %}
					<div class="small">Your credit card was charged less than your pledge of ${{pledge.amount|floatformat:2}}. We can only make whole-penny contributions to the recipients of your contribution, so we had to round down.</div>
				{% endif %}
			{% endif %}
		</dd>

	{% if pledge.status|stringformat:'s' == 'PledgeStatus.Open' %}
		{% if pledge.trigger.status|stringformat:'s' == 'TriggerStatus.Open' %}
			<dt>Status</dt> <dd>The {{trigger.strings.action}} has not yet occurred. The contribution will only be made once it occurs.</dd>
		{% else %}
			<dt>Status</dt> <dd>Your contribution has not yet been made. You are still able to cancel the contribution.</dd>
		{% endif %}
	{% endif %}
	{% if pledge.status|stringformat:'s' == 'PledgeStatus.Vacated' %}
		<dt>Status</dt> <dd>The event that this contribution was pledged for is not expected to occur. The pledge is cancelled.</dd>
	{% endif %}

		<dt>For</dt>
		<dd>
			{{pledge.targets_summary}}

			{% if pledge.status|stringformat:'s' == 'PledgeStatus.Executed' %}
				(<a href="#" onclick="$('#my_recipients').fadeToggle(); return false;">show {{contribs|length}} recipient{{contribs|length|pluralize}}</a>)

				<div id="my_recipients" style="display: none;">
					<table class="table small" style="margin: .5em 0 10px 0">
					<thead>
						<tr><th style="padding-left: 0">Amount</th> <th>Recipient</th></tr>
					</thead>
					<tbody>
					{% for contrib in contribs %}
						<tr><td style="padding-left: 0">${{contrib.amount|floatformat:2}}</td> <td>{{contrib.recipient.name}}</td></tr>
					{% endfor %}
					</tbody>
					</table>
					<p class="small">Plus fees.</p>
				</div>
			{% endif %}		
		</dd>

	{% if pledge.status|stringformat:'s' == 'PledgeStatus.Executed' and pledge.execution.problem|stringformat:'s' == 'PledgeExecutionProblem.NoProblem' %}
	<p><a href="#" onclick="$('#my-contrib-details').fadeToggle(); return false;">show more details</a></p>

	<div id="my-contrib-details" style="display: none">
		<dt>Pledged</dt> <dd>{{pledge.created|date}}</dd>

		<dt>Contributor</dt>
		<dd>
			<p>
				{{pledge.extra.contribNameFirst}} {{pledge.extra.contribNameLast}}<br>
				{{pledge.extra.contribAddress}}<br>
				{{pledge.extra.contribCity}}, {{pledge.extra.contribState}} {{pledge.extra.contribZip}}<br>
				{{pledge.extra.contribOccupation}} / {{pledge.extra.contribEmployer}}
			</p>
			<p class="expl">The information above is made available to the candidates receiving your contributions. If you make $200 in contributions to any one candidate in a calendar year, the information also becomes a matter of public record by law.</p>
		</dd>
	</div>
	{% endif %}

	{% if pledge.status|stringformat:'s' == 'PledgeStatus.Open' %}
	<p><a href="#" onclick="return cancel_pledge()">Cancel?</a></p>
	{% endif %}

</dl>

<script>
function cancel_pledge(desire) {
	show_modal_confirm(
		"Cancel contribution?",
		"Are you sure you want to cancel this contribution?",
		"Cancel Contribution",
		function() {
			ajax({
			    url: '/contrib/_cancel',
			    method: "POST",
			    data: { pledge: {{pledge.id}} },
			    success: function(res) {
			      setTimeout("$('#ajax_loading_indicator').fadeIn()", 100);
			      window.location.reload()
			    }
			})
		});
	return false;
}
</script>


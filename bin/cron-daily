#!/bin/bash

# Move into project root directory.
cd $(dirname $(dirname $(readlink $0)))

# Execute any pledges ready to be executed.
# Log this to a file because these errors are critical. Redirect stderr
# to stdout before piping to tee so that exceptions get logged too.
python3 manage.py execute_pledges 2>&1 | tee -a /tmp/execute_pledges.log

# Send emails: pre-execution, post-execution, and incomplete pledge emails.
# None of the emails affect what pledges can be executed right now, but executing pledges
# makes it possible to send the post-execution email, so we send emails after executing
# pledges.
python3 manage.py send_pledge_emails

# Send email confirmation follow-ups.
python3 manage.py send_anonymous_user_email_confirmation_reminders

# Execute daily cleanup scripts.
python3 manage.py clearsessions
python3 manage.py clear_expired_email_confirmations > /dev/null

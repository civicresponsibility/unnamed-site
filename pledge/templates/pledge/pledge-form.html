<style>
#make-pledge {
	margin-top: 1em;
}
#make-pledge p {
	margin: 1.5em 0;
	text-align: center;
}
#pledge-outcomes {
	margin: 1em 0;
}


#pledge-amount {
	margin: 1em auto;
	max-width: 9em;
	border: 1px solid #AAA;
}
	#pledge-amount .input-group-addon, #pledge-amount input {
		border: none;
		font-size: 24px;
		text-align: right;
	}

#pledge-targets button {
	max-width: 45%;
	white-space: normal;
}
	#pledge-targets button div {
		font-size: 70%;
		padding-top: 5px;
		font-style: italic;
	}


#filter-party label {
	font-weight: normal;
	margin-right: 1em;
}
</style>

<h2>$peak up</h2>

<p>Use this site to pledge a campaign contribution to {{trigger.strings.actors}} who {{trigger.strings.action}} the way you want.</p>


<div id="make-pledge">
	<p>How do you want {{trigger.strings.actors}} to {{trigger.strings.action}}?</p>

	<p id="pledge-outcomes" style="margin-left: 1em">
	{% for outcome in trigger.outcomes %}
		<button class="btn btn-lg" onclick="pledge_choose_outcome(this)">{{outcome.label}}</button>
	{% endfor %}
	</p>

	<p>After the {{trigger.strings.action}}, you will make a campaign contribution of</p>

	<div id="pledge-amount" class="input-group">
	  <div class="input-group-addon">$</div>
	  <input class="form-control" type="text" value="5.00" pattern="^[0-9]+(\.([0-9][0-9])?)?$"onkeyup="update_state()" onchange="update_state()">
	</div>

	<p>to be split evenly to:</p>

	<p id="pledge-targets" style="margin-left: 1em">
		<button class="btn btn-lg incumbents" onclick="pledge_choose_target(this)">
			{{trigger.strings.actors|capfirst}} who {{trigger.strings.action}} <span class="fill-in"> </span>
			<div>(keep &rsquo;em in)</div>
		</button>
		<button class="btn btn-lg challengers" onclick="pledge_choose_target(this)">
			Opponents of {{trigger.strings.actors}} who {{trigger.strings.action}} <span class="fill-in"> </span>
			<div>(throw &rsquo;em out)</div>
		</button>
		<br><span class="small text-muted">(you may choose both)</span>
	</p>

	<p style="margin-top: 0">and only to candidates who are:</p>

	<p id="pledge-party">
		<button class="btn btn-lg" onclick="pledge_filter_party(this)" data-value="R">
			Republicans
		</button>

		<button class="btn btn-lg" onclick="pledge_filter_party(this)" data-value="D">
			Democrats
		</button>

		<button class="btn btn-lg" onclick="pledge_filter_party(this)" data-value="I">
			3<sup>rd</sup> Party
		</button>

		<br><span class="small text-muted">(you may choose more than one)</span>
	</p>

	<p>
		<button id="make-pledge-go" class="btn btn-lg disabled" onclick="pledge_go()">
			Next &gt;
		</button>
	</p>
</div>

<script>
function toggle_buttons(group_selector, elem_clicked, multi) {
	var active_class = 'active btn-success';
	var state = !$(elem_clicked).hasClass(active_class);
	if (!multi) $(group_selector).removeClass(active_class);
	$(elem_clicked).toggleClass(active_class, state);
	$(elem_clicked).blur();
	update_state();
}

function pledge_choose_outcome(elem) {
	toggle_buttons('#pledge-outcomes button', elem);
}
function pledge_choose_target(elem) {
	toggle_buttons('#pledge-targets button', elem, true);
}
function pledge_filter_party(elem) {
	toggle_buttons('#pledge-party button', elem, true);
}

function update_state() {
	var valid = true;

	// outcome
	var active_outcome = $('#pledge-outcomes button.active');
	var alternate_outcome = $('#pledge-outcomes button:not(.active)');
	if (active_outcome.length == 0) {
		$('#pledge-targets .incumbents span.fill-in').text('how you want')
		$('#pledge-targets .challengers span.fill-in').text('against how you want')
		valid = false;
	} else {
		$('#pledge-targets .incumbents span.fill-in').text(active_outcome.text())
		$('#pledge-targets .challengers span.fill-in').text(alternate_outcome.text())
	}

	// make the target buttons the same height, seems to require
	// a delay before getting the text content set above on the
	// initial page load
	setTimeout(function() {
		$('#pledge-targets .btn').css({ height: 'auto' })
		var max_height = 0;
		$('#pledge-targets .btn').each(function() {
			console.log(this, $(this).outerHeight())
			max_height = Math.max(max_height, $(this).outerHeight());
		})
		$('#pledge-targets .btn').css({ height: max_height })
	}, 100)

	// amount
	function validate_number(val) {
		var re = RegExp($('#pledge-amount input').attr('pattern'))
		return re.test(val);
	}
	if (!validate_number($('#pledge-amount input').val())) {
		$('#pledge-amount .input-group-addon').css({ color: '#666' })
		valid = false;
	} else {
		$('#pledge-amount .input-group-addon').css({ color: 'green' })
	}

	// targets
	if ($('#pledge-targets .btn.active').length == 0)
		valid = false;

	// filters
	if ($('#pledge-party .btn.active').length == 0)
		valid = false;

	if (!valid) {
		$('#make-pledge-go').removeClass('btn-warning').addClass('disabled');
	} else {
		$('#make-pledge-go').addClass('btn-warning').removeClass('disabled');
	}

}
</script>